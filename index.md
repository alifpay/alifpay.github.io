### Общие принципы протокола

Взаимодействие Системы и провайдера строится в режиме "запрос-ответ", где инициатором запроса всегда является Система, а отвечающей стороной – провайдер.

Каждый платеж в Системе имеет уникальный идентификатор, который передается в каждом запросе. По этому идентификатору производится дальнейшая сверка взаиморасчетов и решение спорных вопросов.

При обработке запроса от Системы провайдер должен выполнить требуемую операцию, а затем передать в ответе Системе данные (если это требуется) и результат выполнения операции.


## Требования к интерфейсу провайдера

1. Интерфейс должен принимать запросы по протоколу HTTPS 

2. Интерфейс должен обрабатывать параметры, передаваемые системой методам HTTP POST - в теле запроса в виде формате JSON в кодировке UTF-8.

3. Интерфейс должен формировать ответ системе в формате JSON в кодировке UTF-8.

4. Скорость ответа не должна превышать 60 секунд, в противном случае система разрывает соединение по таймауту. 

5. Если предполагаемое количество платежей за услуги подключаемого провайдера, ожидается интенсивным (до 10 платежей в минуту и более), необходимо, чтобы интерфейс поддерживал многопоточную коммуникацию



## Запрос check

При получении запроса check провайдер должен проверить наличие в своей базе абонента с указанным идентификатором и выполнить внутренние проверки идентификатора в соответствии с принятой логикой пополнения лицевых счетов через платежные Системы.

Параметр    |	Условие      |	Описание
----------- | ------------ | -----------------------------------------------------------------------------
action 	    |  Обязательно |	 Идентификация типа запроса: осуществить проверку счета абонента. Всегда равен check  
id 	        |  Обязательно |   Идентификатор платежа в Системе. В базе провайдера не должно содержаться двух успешно проведенных платежей с одним и тем же идентификатором платежа. При получении запроса со значением id, уже существующим в базе провайдера, провайдер должен вернуть результат обработки предыдущего запроса.  
account     |  Обязательно |	Идентификатор абонента в информационной системе провайдера  
provId 	    |  Опционально |	Идентификатор услуги, предоставляемой провайдером (Используется, если провайдер предоставляет более 1 услуги)  
info        |  Опционально |  Дополнительные параметры, передаваемые провайдеру

```markdown

## Пример запроса

POST 
Accept: application/json
Host: service.provider.com:443
Content-type: application/json; charset=utf-8

{
  "id": 12345132564875,
  "action": "check",  
  "account": "123000"
}

// Дополнительные параметры, передаваемые провайдеру

{
  "id": 12345132564875,
  "action": "check",  
  "account": "123000"
  "info":{"fieldId1":"value1","fieldId2":"value2"}
}


## Пример ответа

{
  "code": 302
  "id": 12345132564875,
}

```


## Запрос pay

При получении запроса pay провайдер должен произвести пополнение баланса абонента.
В базе провайдера не должно содержаться двух успешно проведенных платежей с одним и тем же идентификатором платежа (id – идентификатор платежа в Системе). При получении запроса со значением id, уже существующим в базе провайдера, провайдер должен вернуть результат обработки предыдущего запроса. 


Параметр    |	Условие      |	Описание
----------- | ------------ | -----------------------------------------------------------------------------
action 	    |  Обязательно |	 Идентификация типа запроса: Запрос pay. Всегда равен pay  
id 	        |  Обязательно |   Идентификатор платежа в Системе. В базе провайдера не должно содержаться двух успешно проведенных платежей с одним и тем же идентификатором платежа. При получении запроса со значением id, уже существующим в базе провайдера, провайдер должен вернуть результат обработки предыдущего запроса.  
account     |  Обязательно |	Идентификатор абонента в информационной системе провайдера  
amount      |	 Обязательно |	Сумма операции в формате 100.50 
time        |	 Обязательно |	Дата операции (в формате, определённом в стандарте RFC3339. Пример: 2006-01-02T15:04:05Z07:00)
provId 	    |  Опционально |	Идентификатор услуги, предоставляемой провайдером (Используется, если провайдер предоставляет более 1 услуги)  
info        |  Опционально |  Дополнительные параметры, передаваемые провайдеру


```markdown

## Пример запроса

POST 
Accept: application/json
Host: service.provider.com:443
Content-type: application/json; charset=utf-8

{
  "id": 12345132564875,
  "action": "pay",  
  "account": "123000",
  "amount": 100.50,
  "time": "2006-01-02T15:04:05Z07:00"
}

// Дополнительные параметры, передаваемые провайдеру

{
  "id": 12345132564875,
  "action": "pay",  
  "account": "123000",
  "amount": 100.50,
  "time": "2006-01-02T15:04:05Z07:00"
  "info":{"fieldId1":"value1","fieldId2":"value2"}
}


## Пример ответа

{
  "code": 200
  "id": 12345132564875,
  "response_id": "4545487"
}

```

## Параметры ответа

В ответе интерфейс провайдера должен вернуть JSON-документ, со следующими полями:

Параметр    | Условие      | 	Описание
----------- | ------------ | ---------------------------------------------------------
code        | Обязательно  | Код результата операции (code=200 в случае успешной регистрации платежа)
id 	        | Обязательно  | Идентификатор платежа в Системе.
provider_id |	Обязательно  | Уникальный номер операции пополнения баланса абонента (в информационной системе провайдера)


